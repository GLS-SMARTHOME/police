<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Delivery Map - Kinshasa Clean</title>
<style>
  html, body {
    height: 100%;
    margin: 0;
    padding: 0;
    font-family: Arial, sans-serif;
  }
  #map {
    height: 100%;
    width: 100%;
  }
  #eta {
    position: absolute;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    background: white;
    padding: 8px 12px;
    border-radius: 6px;
    font-weight: bold;
    box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    z-index: 5;
  }
</style>
</head>
<body>
<div id="map"></div>
<div id="eta">ETA: -- min</div>

<!-- Google Maps JS API -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDjdnkFWOnh1u2cWf5RFURytU8Zk3fmOhk&libraries=geometry"></script>
<script>
function initMap() {
  const center = { lat: -4.4419, lng: 15.2663 };

  const map = new google.maps.Map(document.getElementById("map"), {
    zoom: 12,
    center: center,
    disableDefaultUI: true, // remove all default UI
    styles: [ // hide labels and points of interest
      { featureType: "all", elementType: "labels", stylers: [{ visibility: "off" }] },
      { featureType: "poi", elementType: "all", stylers: [{ visibility: "off" }] },
      { featureType: "transit", elementType: "all", stylers: [{ visibility: "off" }] },
      { featureType: "road", elementType: "labels", stylers: [{ visibility: "off" }] },
    ]
  });

  // Customer marker
  const customerPos = { lat: -4.4400, lng: 15.2600 };
  const customerMarker = new google.maps.Marker({
    position: customerPos,
    map: map,
    title: "Customer",
    icon: "https://maps.google.com/mapfiles/ms/icons/green-dot.png",
  });

  // Delivery marker (draggable bike)
  const deliveryMarker = new google.maps.Marker({
    position: center,
    map: map,
    draggable: true,
    title: "Delivery Person",
    icon: {
      url: "https://imgur.com/Fm6DstP.png",
      scaledSize: new google.maps.Size(40, 40),
    },
  });

  // Directions Service & Renderer
  const directionsService = new google.maps.DirectionsService();
  const directionsRenderer = new google.maps.DirectionsRenderer({
    map: map,
    suppressMarkers: true,
    polylineOptions: { strokeColor: "#FF0000", strokeWeight: 4, strokeOpacity: 0.7 }
  });

  function updateRoute() {
    directionsService.route(
      {
        origin: deliveryMarker.getPosition(),
        destination: customerMarker.getPosition(),
        travelMode: google.maps.TravelMode.DRIVING,
      },
      (result, status) => {
        if (status === google.maps.DirectionsStatus.OK) {
          directionsRenderer.setDirections(result);
          const leg = result.routes[0].legs[0];
          document.getElementById("eta").innerText = `ETA: ${leg.duration.text}`;
        } else {
          console.error("Directions request failed due to " + status);
          document.getElementById("eta").innerText = `ETA: --`;
        }
      }
    );
  }

  // Initial route
  updateRoute();

  // Update route when bike moves
  deliveryMarker.addListener("position_changed", updateRoute);

  // Optional: alert when delivery is close (<50m)
  let alertShown = false;
  deliveryMarker.addListener("position_changed", () => {
    const distance = google.maps.geometry.spherical.computeDistanceBetween(
      deliveryMarker.getPosition(),
      customerMarker.getPosition()
    );
    if (distance < 50 && !alertShown) {
      alert("Delivery reached the customer!");
      alertShown = true;
    }
  });
}

window.onload = initMap;
</script>
</body>
</html>
